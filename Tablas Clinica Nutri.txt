CREATE TABLE usuarios (
    id INT PRIMARY KEY AUTO_INCREMENT,
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    tipo ENUM('medico', 'paciente') NOT NULL,
    nombre VARCHAR(100) NOT NULL,
    apellido VARCHAR(100) NOT NULL,
    telefono VARCHAR(20),
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    ultimo_login DATETIME,
    activo TINYINT(1) DEFAULT 1,
    token_recuperacion VARCHAR(255),
    expiracion_token DATETIME
);


CREATE TABLE pacientes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT,
    fecha_nacimiento DATE NOT NULL,
    genero ENUM('masculino', 'femenino', 'otro') NOT NULL,
    direccion TEXT,
    altura DECIMAL(5,2) COMMENT 'en cm',
    peso_inicial DECIMAL(5,2) COMMENT 'en kg',
    tipo_sangre VARCHAR(5),
    alergias TEXT,
    condiciones_medicas TEXT,
    medicamentos_actuales TEXT,
    objetivos TEXT,
    contacto_emergencia_nombre VARCHAR(100),
    contacto_emergencia_telefono VARCHAR(20),
    expediente_unique VARCHAR(50) UNIQUE,
    activo TINYINT(1) DEFAULT 1,
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);

CREATE TABLE historial_actualizaciones_pacientes (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    usuario_id INT NOT NULL COMMENT 'Médico que realizó el cambio',
    campo_afectado VARCHAR(100) NOT NULL,
    valor_anterior TEXT,
    valor_nuevo TEXT,
    fecha_actualizacion DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);

CREATE TABLE calendario_nutricionistas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    usuario_id INT NOT NULL COMMENT 'ID del nutricionista',
    fecha DATE NOT NULL,
    hora_inicio TIME NOT NULL,
    hora_fin TIME NOT NULL,
    disponible TINYINT(1) DEFAULT 1,
    bloqueado TINYINT(1) DEFAULT 0,
    motivo_bloqueo VARCHAR(255),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(id)
);
CREATE TABLE citas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    nutricionista_id INT NOT NULL,
    fecha_cita DATE NOT NULL,
    hora_cita TIME NOT NULL,
    estado ENUM('programada', 'confirmada', 'completada', 'cancelada') DEFAULT 'programada',
    motivo_consulta TEXT,
    notas_consulta TEXT,
    fecha_creacion DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id),
    FOREIGN KEY (nutricionista_id) REFERENCES usuarios(id)
);
CREATE TABLE registro_alimentacion (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    fecha DATE NOT NULL,
    tipo_comida ENUM('desayuno', 'almuerzo', 'cena', 'snack') NOT NULL,
    alimentos TEXT NOT NULL,
    horario TIME,
    calorias INT,
    imagen_url VARCHAR(500),
    notas TEXT,
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id)
);
CREATE TABLE registro_ejercicio (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    fecha DATE NOT NULL,
    tipo_ejercicio VARCHAR(100) NOT NULL,
    duracion_minutos INT NOT NULL,
    intensidad ENUM('baja', 'moderada', 'alta') DEFAULT 'moderada',
    calorias_quemadas INT,
    notas TEXT,
    fecha_registro DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id)
);
CREATE TABLE evidencias_fotograficas (
    id INT PRIMARY KEY AUTO_INCREMENT,
    paciente_id INT NOT NULL,
    tipo ENUM('progreso_fisico', 'comida') NOT NULL,
    imagen_url VARCHAR(500) NOT NULL,
    descripcion TEXT,
    fecha_evidencia DATE NOT NULL,
    fecha_subida DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (paciente_id) REFERENCES pacientes(id)
);



